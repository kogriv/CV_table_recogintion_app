# Пример микросервиса для обработки изображений

Репозиторий содержит пример сервиса, который принимает изображения и выдаёт в ответ информацию об изображении.

## Cодержимое репозитория
- _requirements.txt_ - список python библиотек, необходимых для запуска сервиса. Чтобы установить необходимые пакеты, выполните команду
```
    pip install -r requirements.txt
```

- _src/app.py_ - основной скрипт репозитория, который запускает веб-сервер. Чтобы воспользоваться этим файлом, запустите его через вашу IDE (PyCharm, VSCode) или командную консоль.

- _src/model.py_ - файл содержит функцию _process_image_, которая принимает на вход путь до файла изображения, обрабатывает его и выдаёт ответ веб-серверу. Вставьте свой код в эту функцию!

- _src/tmp_ - временная папка, куда будут сохраняться изображения, полученные сервисом.

## Как протестировать

1. Склонируйте репозиторий на локальный компьютер;
2. Перейдите в папку репозитория;
3. Установите необходимые пакеты (pip install -r requirements.txt);
4. Запустите скрипт _app.py_ в папке _src_.
5. В консоле запуска появится сообщение вида
```
INFO:     Started server process [59740]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```
6. Перейдите по ссылкe в последней строке сообщения.
7. В поле выбора файла выберите любой локальный файл с вашего компьютера и нажмите кнопку "Submit Query".
8. Зайдите в папку _src/tmp_ и убедитесь, что загруженный вами файл появился в этой папке.

## Как это работает
1. После запуска скрипта _src/app.py_ на локальном компьютере запускается веб-сервер, который "слушает" входящие запросы на порту 8000.
2. Когда вы переходите по ссылке http://0.0.0.0:8000, то вы создаёте веб запрос, который обрабатывается запущенным сервером.
3. При обращении к странице с, запрос обрабатывается функцией _main_ из файла _app.py_, т.к. ваш запрос не содержит явного указания пути до требуемой веб-страницы. Эта функция возвращает вашему браузеру HTML код, который рисует форму загрузки изображения: поле выбора файла и кнопку "Submit Request". Прочитать подробнее можно [здесь](https://www.w3schools.com/html/html_forms.asp). 
4. После нажатия на кнопку "Submit Request" создаётся ещё один запрос к серверу, но теперь по адресу http://0.0.0.0:8000/ocr, который обрабатывается функцией _process_request_ из файла _app.py_. Содержимое загруженного файла передаётся в этом запросе в переменной _file_.
5. Загруженное изображение сохраняется в папку tmp.
6. Из файла _model.py_ вызывается функция _process_image(file)_, которая получает на вход путь к сохранённому файлу. Ваша задача - добавить в эту функцию код для подготовки изображений (например, выравнивание), извлечения данных (OCR), постобработки данных. Извлеченную информацию необходимо сохранить в JSON-совместимом формате и передать как результат выполнения функции.
7. Результат обработки изображения возвращается пользователю как ответ на его запрос.

## Docker container

Пример того, как упаковать сервис в Docker образ, показан в файле Dockerfile.

Для сборки образа необходимо выполнить команду
```
  docker build --tag ocr:0.1 .
```

Для запуска контейнера
```
  docker run --rm -d -p 8010:8000 --name ocr ocr:0.1
```
после выполнения этой команды сервис будет доступен на порту 8010

Для остановки запущенного контейнера
```
  docker stop ocr
```
 